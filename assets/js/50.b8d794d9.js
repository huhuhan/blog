(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{552:function(t,v,_){"use strict";_.r(v);var s=_(4),a=Object(s.a)({},(function(){var t=this,v=t.$createElement,_=t._self._c||v;return _("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[_("h1",{attrs:{id:"https-应用"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#https-应用"}},[t._v("#")]),t._v(" HTTPS 应用")]),t._v(" "),_("h2",{attrs:{id:"简介"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[t._v("#")]),t._v(" 简介")]),t._v(" "),_("p",[t._v("HTTPS，即"),_("strong",[t._v("超文本传输安全协议")]),t._v("，比HTTP协议多了一层，"),_("strong",[t._v("安全套接层")]),t._v("（SSL/TSL，SSL标准化后改名为TSL）。")]),t._v(" "),_("p",[t._v("在通信端口上，HTTP默认端口是80，HTTPS默认端口是443")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/20220317114408.png",alt:""}})]),t._v(" "),_("h3",{attrs:{id:""}},[_("a",{staticClass:"header-anchor",attrs:{href:"#"}},[t._v("#")])]),t._v(" "),_("h2",{attrs:{id:"加密机制"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#加密机制"}},[t._v("#")]),t._v(" 加密机制")]),t._v(" "),_("p",[t._v("SSL/TSL 这层就负责处理加密解密，HTTPS主要采用"),_("strong",[t._v("数字证书")]),t._v("实现。以下依次介绍各种加密方案")]),t._v(" "),_("h3",{attrs:{id:"对称"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#对称"}},[t._v("#")]),t._v(" 对称")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/20220317114745.png",alt:""}})]),t._v(" "),_("p",[t._v("对称加密算法：加密解密用"),_("strong",[t._v("同一个密钥")])]),t._v(" "),_("p",[t._v("优点：长度固定，加解密耗时短")]),t._v(" "),_("p",[t._v("方案缺点：无论是客户端还是服务端生成密钥A，"),_("strong",[t._v("密钥在传输给对方时可能被劫持")]),t._v("，那么安全就无法保证了")]),t._v(" "),_("blockquote",[_("p",[t._v("ps：即使提前存储，对于B/S架构，客户端浏览器不可能存储所有的HTTPS网站的密钥")])]),t._v(" "),_("h3",{attrs:{id:"非对称"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#非对称"}},[t._v("#")]),t._v(" 非对称")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/20220317115527.png",alt:""}})]),t._v(" "),_("p",[t._v("非对称加密算法：需要"),_("strong",[t._v("一组密钥对")]),t._v("，公钥加密的内容需要对应的私钥解密，私钥加密的内容需要对应的公钥解密，"),_("strong",[t._v("可保证单方向传输的安全性")]),t._v("。")]),t._v(" "),_("p",[t._v("则可以进阶得出以下方案，"),_("strong",[t._v("两组密钥对")])]),t._v(" "),_("p",[_("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/20220317120244.png",alt:""}})]),t._v(" "),_("ol",[_("li",[t._v("先传输各自的公钥给另一端")]),t._v(" "),_("li",[t._v("另一端用公钥加密传输数据，自己这段用私钥解密")])]),t._v(" "),_("p",[t._v("方案缺点：")]),t._v(" "),_("ul",[_("li",[_("strong",[t._v("非对称加密算法，解密耗时长")]),t._v("，特别是较大数据")])]),t._v(" "),_("h3",{attrs:{id:"非对称-对称"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#非对称-对称"}},[t._v("#")]),t._v(" 非对称+对称")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/20220317120840.png",alt:""}})]),t._v(" "),_("ol",[_("li",[t._v("客户端从服务端获取的非对称公钥A1")]),t._v(" "),_("li",[t._v("客户端随机生成密钥X，并用非对称公钥A1，加密，传输给服务端。保证密钥X不泄露。")]),t._v(" "),_("li",[t._v("数据传输用密钥X加密。保证加解密性能问题。")])]),t._v(" "),_("p",[t._v("但是，第一点有漏洞，比如**"),_("code",[t._v("中间人劫持")]),t._v("，构造假密钥**")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/20220317144349.png",alt:""}})]),t._v(" "),_("p",[t._v("问题：如何保证客户端收到的公钥是正确安全的？")]),t._v(" "),_("h3",{attrs:{id:"数字证书-非对称-签名-对称"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#数字证书-非对称-签名-对称"}},[t._v("#")]),t._v(" 数字证书（非对称+签名+对称）")]),t._v(" "),_("p",[t._v("针对上面的问题，用"),_("strong",[t._v("数字证书")]),t._v("可以保证客户端收到公钥是正确的！")]),t._v(" "),_("p",[t._v("证书由"),_("strong",[t._v("CA机构")]),t._v("颁发。（CA机构，即互联网公信机构）")]),t._v(" "),_("p",[t._v("证书信息很多，可以找个网站查看，如下")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/20220317153327.png",alt:""}})]),t._v(" "),_("p",[t._v("那么证书，可能会有"),_("code",[t._v("中间人劫持")]),t._v("伪造吗？不会！因为其中有"),_("strong",[t._v("数字签名")]),t._v("！")]),t._v(" "),_("p",[t._v("数字证书申请制作步骤：")]),t._v(" "),_("ol",[_("li",[t._v("填写基本信息，比如地区、组织、名称（域名）等等，去CA机构申请审核")]),t._v(" "),_("li",[t._v("CA机构用基本信息，生成非对称密钥M1，其中M1的公钥也就是证书源文件（CSR文件）")]),t._v(" "),_("li",[t._v("CA机构将基本信息，用哈希算法计算得到哈希值，假设为H1")]),t._v(" "),_("li",[t._v("CA机构将H1用私有的非对称加密，得到签名，"),_("strong",[t._v("即数字签名")]),t._v("。（假设这里是M2，另一组密钥）")]),t._v(" "),_("li",[t._v("将数字签名、证书源文件（M1公钥）、用的哈希算法、有效期、基本信息等等，组成"),_("strong",[t._v("数字证书")]),t._v("（也是加密文件）")]),t._v(" "),_("li",[t._v("最终CA机构返回"),_("strong",[t._v("数字证书")]),t._v("文件、M1的私钥等多个文件")])]),t._v(" "),_("p",[t._v("服务器配置，只需用到数字证书文件、M1的私钥（绝不可泄露）")]),t._v(" "),_("p",[t._v("所以，即使"),_("code",[t._v("中间人劫持")]),t._v("，没有CA的私钥M2是无法伪造签名的")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/20220317151443.png",alt:""}})]),t._v(" "),_("p",[t._v("客户端浏览器验证数字证书中的签名：")]),t._v(" "),_("ol",[_("li",[t._v("获取数字证书，解析出其中信息（数字签名、证书源-M1公钥、用的哈希算法），对应上面第5点")]),t._v(" "),_("li",[t._v("根据指定的哈希算法，同理计算得出H2，对称上面第3点")]),t._v(" "),_("li",[t._v("浏览器会内置信任机构的公钥，就是上面第4点的M2公钥，解密出签名中的H1")]),t._v(" "),_("li",[t._v("判断H2是否等于H1，即可验证签名是否真实。")])]),t._v(" "),_("p",[t._v("最终，浏览器用M1公钥，加密随机成生的对称密钥S，给服务端；服务端用M1私钥解析后，用密钥S加密通信！")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/20220317150511.png",alt:""}})]),t._v(" "),_("p",[t._v("问题：对于"),_("code",[t._v("中间人劫持")])]),t._v(" "),_("ul",[_("li",[_("p",[t._v("证书无可伪造，其中有签名验证")])]),t._v(" "),_("li",[_("p",[t._v("签名无法伪造，其中只有CA机构有私钥")])]),t._v(" "),_("li",[_("p",[t._v("证书中M1公钥或部分信息也无法伪造，因为证书是完整的加密文件，有验证域名这些唯一信息等等")])])]),t._v(" "),_("p",[t._v("总结：")]),t._v(" "),_("ul",[_("li",[t._v("HTTPS的选择的方案是，数字证书（非对称+签名+对称）")]),t._v(" "),_("li",[t._v("数据传输的加密方案不变，采用对称密钥")]),t._v(" "),_("li",[t._v("用非对称+签名保证传输对称密钥不被挟持更改")])]),t._v(" "),_("h2",{attrs:{id:"配置应用"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#配置应用"}},[t._v("#")]),t._v(" 配置应用")]),t._v(" "),_("h3",{attrs:{id:"申请证书"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#申请证书"}},[t._v("#")]),t._v(" 申请证书")]),t._v(" "),_("ul",[_("li",[t._v("现在申请数字证书，包括上面提到的CSR文件，各大网站基本帮助省略了。暂不介绍了。"),_("a",{attrs:{href:"https://cloud.tencent.com/document/product/400",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考腾讯文档"),_("OutboundLink")],1)]),t._v(" "),_("li",[t._v("因为证书本质是一组非对称密钥，可以自己生成一组非对称密钥文件。模拟证书，非CA机构认证。区别就是浏览器会提示不安全")])]),t._v(" "),_("h3",{attrs:{id:"配置应用-2"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#配置应用-2"}},[t._v("#")]),t._v(" 配置应用")]),t._v(" "),_("ul",[_("li",[_("RouterLink",{attrs:{to:"/#/views/network/nginx.html"}},[t._v("nginx配置，模拟证书")])],1)])])}),[],!1,null,null,null);v.default=a.exports}}]);