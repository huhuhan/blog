(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{518:function(s,a,t){"use strict";t.r(a);var e=t(4),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),t("p",[s._v("基于MySQL服务器的的开源备份软件。")]),s._v(" "),t("p",[s._v("功能支持：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("全量备份")])]),s._v(" "),t("li",[t("p",[s._v("增量备份")])]),s._v(" "),t("li",[t("p",[s._v("传输压缩的备份文件至其他服务器")])])]),s._v(" "),t("p",[s._v("优势特点：")]),s._v(" "),t("ul",[t("li",[s._v("备份、还原速度快")]),s._v(" "),t("li",[s._v("备份过程不打断正在执行的事务，即InnoDB热备份")]),s._v(" "),t("li",[s._v("备份检验")])]),s._v(" "),t("p",[s._v("官方文档："),t("a",{attrs:{href:"https://www.percona.com/doc/percona-xtrabackup/2.3/index.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),t("OutboundLink")],1),s._v("、"),t("a",{attrs:{href:"https://www.percona.com/doc/percona-xtrabackup/LATEST/xtrabackup_bin/xbk_option_reference.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("参数说明"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("参考博客："),t("a",{attrs:{href:"https://blog.51cto.com/zero01/2468469",target:"_blank",rel:"noopener noreferrer"}},[s._v("数据库备份还原"),t("OutboundLink")],1),s._v("、"),t("a",{attrs:{href:"https://www.zsythink.net/archives/1455",target:"_blank",rel:"noopener noreferrer"}},[s._v("XtraBackup参考"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("实际备份")]),s._v(" "),t("h2",{attrs:{id:"安装运行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装运行"}},[s._v("#")]),s._v(" 安装运行")]),s._v(" "),t("blockquote",[t("p",[s._v("xtrabackup必须和MySQL安装同一服务器，需要"),t("strong",[s._v("能连接交互")]),s._v("。")]),s._v(" "),t("p",[s._v("所以不同形式的安装，对于后面的操作命令不同。")]),s._v(" "),t("p",[t("strong",[s._v("MySQL版本5.7.x，对应XtraBackup稳定版2.4")])]),s._v(" "),t("p",[t("strong",[s._v("MySQL版本8.0.x，对应XtraBackup稳定版8.0")])])]),s._v(" "),t("h3",{attrs:{id:"系统安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#系统安装"}},[s._v("#")]),s._v(" 系统安装")]),s._v(" "),t("p",[s._v("参考"),t("a",{attrs:{href:"https://www.percona.com/downloads/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),t("OutboundLink")],1)]),s._v(" "),t("h3",{attrs:{id:"容器安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#容器安装"}},[s._v("#")]),s._v(" 容器安装")]),s._v(" "),t("h4",{attrs:{id:"安装mysql"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装mysql"}},[s._v("#")]),s._v(" 安装MySQL")]),s._v(" "),t("p",[s._v("Docker安装MySQL，可以参考"),t("RouterLink",{attrs:{to:"/views/db/mysql.html#安装"}},[s._v("MySQL安装")])],1),s._v(" "),t("blockquote",[t("p",[s._v("需要挂载的目录：")]),s._v(" "),t("ul",[t("li",[s._v("数据库目录，默认配置路径是"),t("code",[s._v("/var/lib/mysql")])]),s._v(" "),t("li",[s._v("socket目录，默认配置路径是"),t("code",[s._v("/var/run/mysqld")])])]),s._v(" "),t("p",[s._v("建议也挂载配置文件（目录）")])]),s._v(" "),t("h4",{attrs:{id:"安装xtrbackup"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装xtrbackup"}},[s._v("#")]),s._v(" 安装XtrBackup")]),s._v(" "),t("div",{staticClass:"language-yml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker-compose")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("xtrbackup")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" xtrbackup\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" bitnami/percona"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("xtrabackup"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.4")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("TZ")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Asia/Shanghai\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /ws/soft/xtrabackup/backup"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/backup\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /ws/soft/mysql/data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/mysql/data\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /ws/soft/mysql/socket"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/mysql/socket\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("blockquote",[t("p",[s._v("重点是挂载目录！这里"),t("strong",[s._v("不包括MySQL的配置文件目录")]),s._v("。分别是：")]),s._v(" "),t("ul",[t("li",[s._v("备份目录："),t("code",[s._v("/ws/soft/xtrabackup/backup")])]),s._v(" "),t("li",[s._v("MySQL数据库目录："),t("code",[s._v("/ws/soft/mysql/data")])]),s._v(" "),t("li",[s._v("MySQL的socket文件目录："),t("code",[s._v("/ws/soft/mysql/socket")])])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/20210811101908.png",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/20210811102008.png",alt:""}})])]),s._v(" "),t("p",[s._v("运行后进入容器操作，"),t("strong",[s._v("需要和MySQL容器在同一个docker网络中")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("docker-compose up -d\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("docker "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器ID"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" /bin/bash\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"操作命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#操作命令"}},[s._v("#")]),s._v(" 操作命令")]),s._v(" "),t("blockquote",[t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看命令的参数")]),s._v("\ninnobackupex --help\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("注意打印日志，成功后最后行都会有"),t("code",[s._v("completed OK!")])])]),s._v(" "),t("h3",{attrs:{id:"docker版本区别"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker版本区别"}},[s._v("#")]),s._v(" Docker版本区别")]),s._v(" "),t("p",[s._v("以全量备份为例。命令在容器内部操作。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最简单命令，在/backup目录下生成备份目录（日期命名）")]),s._v("\ninnobackupex -p 111111yh"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" /backup\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("blockquote",[t("p",[s._v("看官方的参数说明文档，省略以下默认缺省参数：")]),s._v(" "),t("p",[s._v("主机"),t("code",[s._v("-H localhost")]),s._v("\n端口"),t("code",[s._v("-P 3306")]),s._v("\n用户名 "),t("code",[s._v("-u root")]),s._v("\n配置文件 "),t("code",[s._v("-default-file /etc/my.cnf")]),s._v("，主要读取2个属性")]),s._v(" "),t("ul",[t("li",[s._v("数据库目录"),t("code",[s._v("datadir=/var/lib/mysql")])]),s._v(" "),t("li",[s._v("socket文件 "),t("code",[s._v("socket=/var/run/mysqld/mysqld.sock")])])]),s._v(" "),t("p",[s._v("备份目录"),t("code",[s._v("--backup --target-dir = /data/backups/")]),s._v(" 省略为"),t("code",[s._v("/backup")])])]),s._v(" "),t("p",[s._v("因为Docker的文件挂载问题，即使挂载配置文件，读取的属性也是不对的，所以"),t("strong",[s._v("配置属性都要单独指定")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker版本最简单命令")]),s._v("\ninnobackupex -P 111111yh"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" --socket"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/mysql/socket/mysqld.sock --datadir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/mysql/data/ /backup\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("blockquote",[t("p",[s._v("MySQL的"),t("code",[s._v("socket")]),s._v("和"),t("code",[s._v("datadir")]),s._v("需要挂载到xtrabackup容器内，参考上面的安装")])]),s._v(" "),t("h3",{attrs:{id:"全量备份还原"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#全量备份还原"}},[s._v("#")]),s._v(" 全量备份还原")]),s._v(" "),t("p",[s._v("以Docker版本介绍命令")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("全量备份")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 备份后，/backup下自动生成目录（日期取名），注意打印的日志")]),s._v("\ninnobackupex  -p 111111yh"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" --socket"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/mysql/socket/mysqld.sock --datadir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/mysql/data/ --databases"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tt  /backup\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("指定某数据库备份")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 参数--databases=tt 可以对比上面的全量备份")]),s._v("\ninnobackupex  -p 111111yh"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" --socket"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/mysql/socket/mysqld.sock --datadir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/mysql/data/ --databases"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tt  /backup\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("还原前，数据检验一致性")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 还原前的操作，可以对比备份文件")]),s._v("\ninnobackupex --apply-log /backup/2021-08-11_11-05-51\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认空间是100M，日志多的话，可指定空间大小[--use-memory=2G]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("准备新库")]),s._v(" "),t("ul",[t("li",[s._v("Docker安装MySQL，配置文件与原来的一致")]),s._v(" "),t("li",[s._v("Docker安装XtraBackup，挂载上述MySQL相关目录")]),s._v(" "),t("li",[s._v("停止MySQL，删除默认初始化的数据库目录")])]),s._v(" "),t("blockquote",[t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("或者是备份下之前的MySQL数据库目录，再清空\n\n```shell\n# 目录/mysql/data，在mysql目录下执行\nmv data{,backup}\n# 重建目录\n")])])]),t("p",[s._v("mkdir data\n# 赋权限\nchown -R polkitd:input data\n```")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("```go\n[root@iZwz93hnu1fbgr0tcl2abzZ mysql]# ls -l\ntotal 16\ndrwxr-xr-x 2 polkitd input 4096 Aug  6 10:24 config\n")])])]),t("p",[s._v("drwxr-xr-x 2 polkitd input 4096 Aug 11 11:45 data\ndrwxr-xr-x 7 polkitd input 4096 Aug 11 11:42 databackup\ndrwxr-xr-x 2 polkitd input 4096 Aug 11 11:42 socket\n```")])])]),s._v(" "),t("li",[t("p",[s._v("还原至新库中")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里sokect、datadir是新库的挂载目录")]),s._v("\ninnobackupex -socket"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/mysql/socket/mysqld.sock --datadir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/mysql/data --copy-back /backup/2021-08-11_11-05-51\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("启动数据库，验证数据")])])]),s._v(" "),t("blockquote",[t("p",[s._v("指定某数据库备份，但还原还是准备新库还原，再把那个库的文件拷贝出来。")])]),s._v(" "),t("h3",{attrs:{id:"增量备份还原"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#增量备份还原"}},[s._v("#")]),s._v(" 增量备份还原")]),s._v(" "),t("p",[s._v("以Docker版本介绍命令")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("第一次，全量备份，参考上面命令")])]),s._v(" "),t("li",[t("p",[s._v("数据库变动，比如增、删、改")])]),s._v(" "),t("li",[t("p",[s._v("增量备份，假设上次备份目录是"),t("code",[s._v("/backup/2021-08-11_11-05-51")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --incremental /backup，增量备份的目录也存放在/backup下")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --incremental-basedir=/xxx 指定上个备份目录")]),s._v("\ninnobackupex  -p 111111yh"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" --socket"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/mysql/socket/mysqld.sock --datadir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/mysql/data/ --incremental /backup --incremental-basedir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/backup/2021-08-11_11-05-51\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("blockquote",[t("p",[s._v("备份目录下的"),t("code",[s._v("xtrabackup_checkpoints")]),s._v("，描述了备份类型，数据大小等等")])])]),s._v(" "),t("li",[t("p",[s._v("还原备份，和上面一样，还原到新库中。准备新库。")])]),s._v(" "),t("li",[t("p",[s._v("检查数据一致性。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第一次的全量备份，除了最后次外都加上 --redo-only参数，即事务不会回滚。")]),s._v("\ninnobackupex --apply-log --redo-only /backup/2021-08-11_11-05-51\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第二次的增量备份，即最后份。在全量备份目录基础上还原增量的备份")]),s._v("\ninnobackupex --apply-log /backup/2021-08-11_11-05-51 --incremntal-dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/backup/2021-08-11_11-35-33\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("blockquote",[t("p",[s._v("备份目录下的"),t("code",[s._v("xtrabackup_checkpoints")]),s._v("，备份类型已经变化")])])]),s._v(" "),t("li",[t("p",[s._v("还原至新库中")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里sokect、datadir是新库的挂载目录")]),s._v("\ninnobackupex -socket"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/mysql/socket/mysqld.sock --datadir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/mysql/data --copy-back /backup/2021-08-11_11-05-51\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("启动数据库，验证数据")])])]),s._v(" "),t("h3",{attrs:{id:"其他命令参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#其他命令参数"}},[s._v("#")]),s._v(" 其他命令参数")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 并行备份，即多线程操作，会增加IO")]),s._v("\ninnobackupex -p 111111yh"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" --parallel"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" /backup\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 节流备份，与上面相反，节省IO，参数表示每秒限制操作IO的次数")]),s._v("\ninnobackupex -p 111111yh"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" --throttle"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" /backup\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 压缩备份，压缩算法是“quicklz”，后缀名是“.qp"')]),s._v("\ninnobackupex -p 111111yh"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" --compress /backup\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 压缩线程数量")]),s._v("\ninnobackupex -p 111111yh"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" --compress --compress-threads"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" /backup\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解压备份文件，前提安装了qpress")]),s._v("\ninnobackupex --decompress /backup/2021-08-14_11-05-51\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("blockquote",[t("p",[s._v("压缩的话，还原前需要解压，从"),t("a",{attrs:{href:"http://www.quicklz.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("quickLZ"),t("OutboundLink")],1),s._v("官方下载命令脚本")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://www.quicklz.com/qpress-11-linux-x64.tar\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解压得到qpress，移动到命令行目录下/user/local/bin")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解压文件至当前目录")]),s._v("\nqpress -d test.qp ./\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 循环当前目录下.qp文件，解压至当前目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("bf")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" -iname "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*\\.qp"')]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" qpress -d "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$bf")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("dirname")]),s._v(" $bf"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$bf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 流备份，并重新向到备份文件中，否则只是输出控制台（一堆乱码）")]),s._v("\ninnobackupex  -p 111111yh"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" --stream "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" /backup "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/backup/tt.tar\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 加上 gzip 压缩。也可以用其他压缩方式，或分步操作")]),s._v("\ninnobackupex  -p 111111yh"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" --stream "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" /backup "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("gzip")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/backup/tt.tar.gz\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 也可以单独用压缩命令")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zcvf tt2.tar.gz /backup/2021-08-11_11-05-51 -C /backup\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 流的操作，还可以直接输出到远程机子上，通过ssh")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h3",{attrs:{id:"主从分库的应用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#主从分库的应用"}},[s._v("#")]),s._v(" 主从分库的应用")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://segmentfault.com/a/1190000004452276",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考博客"),t("OutboundLink")],1),s._v("，后续实践了再更新")])])}),[],!1,null,null,null);a.default=n.exports}}]);