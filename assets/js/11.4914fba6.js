(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{512:function(s,t,a){"use strict";a.r(t);var n=a(4),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),a("h3",{attrs:{id:"docker方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker方式"}},[s._v("#")]),s._v(" docker方式")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("选择镜像下载")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 官方镜像,启动后再安装中文插件")]),s._v("\ndocker pull jenkins/jenkins:lts\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 中文社区的版本,优化镜像源,推荐直接用这个版本")]),s._v("\ndocker pull jenkinszh/jenkins-zh:lts\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("运行命令")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("docker run -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":8080 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50000")]),s._v(":5000 --name jenkins "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-u root "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-v /mydata/jenkins_home:/var/jenkins_home "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-d jenkins/jenkins:lts\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("中文社区版本"),a("code",[s._v("jenkins-zh.yml")])]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("jenkins-zh")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器名")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" jenkins"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("zh\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启策略: 容器退出时总是重启容器")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建镜像名称，没有build属性默认从远程仓库获取")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" jenkinszh/jenkins"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("zh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("lts\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("TZ")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Asia/Shanghai\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 网页端口")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 9888"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# JNLP代理端口")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 40000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /home/soft/jenkins"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("zh/jenkins_home"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/var/jenkins_home\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#容器内部角色")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])])])]),s._v(" "),a("h3",{attrs:{id:"启动密码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动密码"}},[s._v("#")]),s._v(" 启动密码")]),s._v(" "),a("p",[s._v("输入初始化密码（默认保存在以下路径文件中）")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/20200714115212.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"插件安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#插件安装"}},[s._v("#")]),s._v(" 插件安装")]),s._v(" "),a("blockquote",[a("p",[s._v("安装向导中，因为镜像仓库无法联网问题，"),a("strong",[s._v("插件安装失败可以先跳过")]),s._v("，等进入页面后再搜索下载")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/20200714135552.png",alt:""}})])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("修改"),a("code",[s._v("hudson.model.UpdateCenter.xml")]),s._v("配置文件")]),s._v(" "),a("p",[s._v("先试试镜像仓库地址是否可以访问，选择个合适的")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 官方默认\nhttp://updates.jenkins.io/update-center.json \n中文社区，好像也不能访问了\nhttps://updates.jenkins-zh.cn/update-center.json\n# 清华大学\nhttp://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("或者进入页面后，左侧【Manage Jenkins（系统管理）】- 底部【Manage Plugins（插件配置）】-【高级】最下面，设置镜像仓库，重启")])]),s._v(" "),a("li",[a("p",[s._v("在【可选插件】tab页面，安装需要的插件，插件依赖也会自动安装，"),a("strong",[s._v("安装后重启生效")])])]),s._v(" "),a("li",[a("p",[s._v("重启操作，可以用【系统管理】-【读取设置】")])])]),s._v(" "),a("h2",{attrs:{id:"推荐插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#推荐插件"}},[s._v("#")]),s._v(" 推荐插件")]),s._v(" "),a("blockquote",[a("p",[s._v("可以先统一下载需要的插件，一起重启Jenkins，否则每次下载插件再重启生效很费时间！！")])]),s._v(" "),a("h3",{attrs:{id:"中文化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#中文化"}},[s._v("#")]),s._v(" 中文化")]),s._v(" "),a("p",[s._v("插件名是："),a("code",[s._v("Localization: Chinese")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/20220117160901.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"gitlab"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gitlab"}},[s._v("#")]),s._v(" GitLab")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("插件名："),a("a",{attrs:{href:"https://plugins.jenkins.io/gitlab-plugin",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitLab"),a("OutboundLink")],1)])]),s._v(" "),a("li",[a("p",[s._v("会自动安装依赖的插件，比如Git、"),a("a",{attrs:{href:"https://plugins.jenkins.io/gitlab-hook",target:"_blank",rel:"noopener noreferrer"}},[s._v("Gitlab Hook Plugin"),a("OutboundLink")],1),s._v("等等一推插件")])]),s._v(" "),a("li",[a("p",[s._v("最常用的，就是在项目构建中，拉取项目仓库代码")]),s._v(" "),a("ul",[a("li",[s._v("可以直接用http方式")]),s._v(" "),a("li",[s._v("认证，直接用用户密码方式")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/20220117180302.png",alt:""}})])])]),s._v(" "),a("h3",{attrs:{id:"maven"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#maven"}},[s._v("#")]),s._v(" Maven")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("选择这个插件："),a("a",{attrs:{href:"https://plugins.jenkins.io/config-file-provider",target:"_blank",rel:"noopener noreferrer"}},[s._v("Config File Provider"),a("OutboundLink")],1)])]),s._v(" "),a("li",[a("p",[s._v("【系统管理】-【全局工具配置】- 新增，保存后重启Jenkins才会安装")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/20200714145918.png",alt:""}})]),s._v(" "),a("p",[s._v("安装后"),a("code",[s._v("/var/jenkins_home/tools")]),s._v(" 下会有maven的目录，修改"),a("code",[s._v("conf/setting.xml")])]),s._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- /var/jenkins_home 为dockers内部映射路径 --\x3e")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("localRepository")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("/var/jenkins_home/.m2/repository"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("localRepository")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("mirror")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("id")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("aliyunmaven"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("id")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("mirrorOf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("central"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("mirrorOf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("阿里云公共仓库"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("https://maven.aliyun.com/repository/public"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("mirror")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("这样maven仓库也映射到宿主机上了（"),a("strong",[s._v(".m2默认为隐藏文件夹")]),s._v("）")])])]),s._v(" "),a("h3",{attrs:{id:"nodejs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nodejs"}},[s._v("#")]),s._v(" NodeJS")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("选择这个插件："),a("a",{attrs:{href:"https://plugins.jenkins.io/nodejs",target:"_blank",rel:"noopener noreferrer"}},[s._v("NodeJS"),a("OutboundLink")],1)])]),s._v(" "),a("li",[a("p",[s._v("【系统管理】- 【全局工具配置】- 新增，保存后重启Jenkins才会安装")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/20200721155443.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"publish-over-ssh"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#publish-over-ssh"}},[s._v("#")]),s._v(" Publish Over SSH")]),s._v(" "),a("ul",[a("li",[s._v("插件："),a("a",{attrs:{href:"https://plugins.jenkins.io/publish-over-ssh",target:"_blank",rel:"noopener noreferrer"}},[s._v("Publish Over SSH"),a("OutboundLink")],1)]),s._v(" "),a("li",[s._v("【系统管理】-【系统配置】- "),a("strong",[s._v("Publish over SSH")])]),s._v(" "),a("li",[s._v("新增链接，部分字段需要点击【高级】\n"),a("ul",[a("li",[s._v("昵称：name")]),s._v(" "),a("li",[s._v("服务IP：hostname")]),s._v(" "),a("li",[s._v("相对路径：Remote Directory，即包传送到服务器的【根目录】")]),s._v(" "),a("li",[s._v("账户：username")]),s._v(" "),a("li",[s._v("密码，需要先勾选"),a("strong",[s._v("Use password authentication, or use a different key")])]),s._v(" "),a("li",[s._v("端口：ssh端口，比如22")]),s._v(" "),a("li",[s._v("超时：timeout")])])]),s._v(" "),a("li",[s._v("测试连接")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/20201116171528.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("实际应用，参考下面的【发布后端】等例子")])]),s._v(" "),a("h2",{attrs:{id:"应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#应用"}},[s._v("#")]),s._v(" 应用")]),s._v(" "),a("blockquote",[a("p",[s._v("若是推荐插件安装，以下部分插件已经默认安装")])]),s._v(" "),a("h3",{attrs:{id:"凭证管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#凭证管理"}},[s._v("#")]),s._v(" 凭证管理")]),s._v(" "),a("p",[s._v("【系统管理】-【凭证（Manage Credentials）】")]),s._v(" "),a("ul",[a("li",[s._v("方式有：用户密码方式、API Token、私秘钥等等")]),s._v(" "),a("li",[s._v("应用场景：gitlab仓库凭证、SSH凭证。填写时"),a("strong",[s._v("建议加上描述字段")])])]),s._v(" "),a("p",[a("a",{attrs:{href:"https://blog.csdn.net/weixin_42867972/article/details/105565913",target:"_blank",rel:"noopener noreferrer"}},[s._v("可参考博客"),a("OutboundLink")],1)]),s._v(" "),a("h3",{attrs:{id:"角色权限管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#角色权限管理"}},[s._v("#")]),s._v(" 角色权限管理")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("选择这个插件："),a("a",{attrs:{href:"https://plugins.jenkins.io/role-strategy",target:"_blank",rel:"noopener noreferrer"}},[s._v("Role-based Authorization Strategy"),a("OutboundLink")],1),s._v("，安装后重启")])]),s._v(" "),a("li",[a("p",[s._v("【系统管理】-【全局安全配置】-【授权策略】选择"),a("code",[s._v("Role-Based Strategy")]),s._v("策略")])]),s._v(" "),a("li",[a("p",[s._v("【系统管理】-【Manage and Assign Roles】")])]),s._v(" "),a("li",[a("p",[s._v("【Manage Roles】创建角色，分配权限")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("全局角色：控制全局权限，比如左侧菜单、视图等")]),s._v(" "),a("blockquote",[a("p",[s._v("推荐一个"),a("strong",[s._v("子管理员")]),s._v("角色和"),a("strong",[s._v("只读")]),s._v("角色，如图")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/20210813143406.png",alt:""}})])])]),s._v(" "),a("li",[a("p",[s._v("项目角色：根据正则匹配，项目名称"),a("strong",[s._v("统一前缀")]),s._v("，比如"),a("code",[s._v("iot.*")])]),s._v(" "),a("blockquote",[a("p",[s._v("子管理员，直接勾选全部，如图"),a("code",[s._v("iot")]),s._v("，只读权限如图"),a("code",[s._v("farm")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/20210813114325.png",alt:""}})])])])])]),s._v(" "),a("li",[a("p",[s._v("【Assgin Roles】分配用户-权限角色")]),s._v(" "),a("ul",[a("li",[s._v("输入"),a("code",[s._v("用户登录名")]),s._v("添加（刷新后才会显示用户昵称）")]),s._v(" "),a("li",[s._v("根据需求分配用户的权限角色")])]),s._v(" "),a("blockquote",[a("p",[s._v("两个用户，"),a("code",[s._v("iot")]),s._v("负责iot项目管理和"),a("code",[s._v("iot-user")]),s._v("只能构建iot项目")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/20210813114424.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/1628826279650.png",alt:""}})])])]),s._v(" "),a("li",[a("p",[s._v("【系统管理】-【读取配置】即重启jenkins，刷新配置信息")])])]),s._v(" "),a("h3",{attrs:{id:"新建任务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新建任务"}},[s._v("#")]),s._v(" 新建任务")]),s._v(" "),a("ul",[a("li",[s._v("选择【构建一个自由风格的软件项目】即可")]),s._v(" "),a("li",[s._v("善于用最低下的【复制】功能，复制现有的项目任务，直接改配置")])]),s._v(" "),a("h3",{attrs:{id:"发布后端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#发布后端"}},[s._v("#")]),s._v(" 发布后端")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("创建项目，比如【JavaA】，则项目路径是"),a("code",[s._v("/workspace/JavaA")])])]),s._v(" "),a("li",[a("p",[s._v("源码管理：拉取项目代码，基于插件Git")])]),s._v(" "),a("li",[a("p",[s._v("可选，构建触发器：【Build when a change is pushed to GitLab.】参考插件"),a("a",{attrs:{href:"#gitlab-%E8%A7%A6%E5%8F%91%E6%9E%84%E5%BB%BA"}},[s._v("GitLab hook")])])]),s._v(" "),a("li",[a("p",[s._v("构建：【调用顶层maven目录】基于插件"),a("a",{attrs:{href:"#maven"}},[s._v("Maven")])]),s._v(" "),a("ol",[a("li",[a("p",[s._v("选择版本")])]),s._v(" "),a("li",[a("p",[s._v("目标：即maven命令，参考下")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("-DskipTests=true clean package\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("POM：默认项目根目录")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("${WORKSPACE}/pom.xml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("其他配置自行选择")])])])]),s._v(" "),a("li",[a("p",[s._v("构建：【Send files or execute commonds over SSH】即在对应服务器上编写执行脚本命令")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("选择服务器，假设该服务器配置【根目录】是"),a("code",[s._v("/yh/jenkins")]),s._v("。参考插件"),a("a",{attrs:{href:"#publish-over-ssh"}},[s._v("publish-over-ssh")])])]),s._v(" "),a("li",[a("p",[s._v("当前【JavaA】的工作空间，即"),a("code",[s._v("/workspace/JavaA")])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("Source files")]),s._v("：工作空间下的jar包路径。假设是"),a("code",[s._v("target/javaA.jar")])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("Remove prefix")]),s._v("：去掉目录前缀，默认Source files的值。假设是"),a("code",[s._v("target")])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("Remote directory")]),s._v("：上面的【根目录】拼接当前值。假设填入是"),a("code",[s._v("/aa")])])]),s._v(" "),a("li",[a("p",[s._v("最终推送到服务器的jar包路径为："),a("code",[s._v("/yh/jenkins/aa/javaA.jar")])])]),s._v(" "),a("li",[a("p",[s._v("最终路径="),a("strong",[s._v("【根目录】 +  Remote directory +（Source files - Remove prefix）")])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("Exec command")]),s._v("：远程服务器的shell命令")])]),s._v(" "),a("li",[a("p",[s._v("参考例子，如图")]),s._v(" "),a("p",[s._v("​\t"),a("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/20200721153744.png",alt:""}})])])])])]),s._v(" "),a("h3",{attrs:{id:"发布前端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#发布前端"}},[s._v("#")]),s._v(" 发布前端")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("创建项目，比如【VueA】，则项目路径是"),a("code",[s._v("/workspace/VueA")])])]),s._v(" "),a("li",[a("p",[s._v("源码管理：拉取项目代码，基于插件Git")])]),s._v(" "),a("li",[a("p",[s._v("构建环境：【Provide Node & npm bin/ folder to PATH】基于插件"),a("a",{attrs:{href:"#nodejs"}},[s._v("NodeJS")])]),s._v(" "),a("ol",[a("li",[s._v("选择安装的NodeJS版本")]),s._v(" "),a("li",[s._v("其他默认")])])]),s._v(" "),a("li",[a("p",[s._v("构建：【执行 Shell】写些脚本（初始化、构建、打包），参考如下")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# npm 方式")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("alias")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cnpm")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"npm --registry=https://registry.npm.taobao.org \\\n--cache='),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.npm/.cache/cnpm \\\n--disturl=https://npm.taobao.org/dist \\\n--userconfig="),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v('/.cnpmrc"')]),s._v("\ncnpm "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" \ncnpm run build\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除上次打包生成的压缩文件、再打包")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf yh-ui.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zcvf yh-ui.tar.gz dist\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yarn 方式")]),s._v("\nnode -v\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -g "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v(" -registry"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://registry.npm.taobao.org\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v(" -v\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这个参数是在服务器install不生成yarn.lock，防止服务器和本地代码冲突")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --pure-lockfile\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v(" run build\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除上次打包生成的压缩文件、再打包")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf yh-ui.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zcvf yh-ui.tar.gz dist\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("构建：【Send files or execute commonds over SSH】即在对应服务器上编写执行脚本命令")]),s._v(" "),a("ul",[a("li",[s._v("和上面"),a("a",{attrs:{href:"#%E5%8F%91%E5%B8%83%E5%90%8E%E7%AB%AF"}},[s._v("发布后端")]),s._v("一样")]),s._v(" "),a("li",[s._v("假设选择的服务器【根目录】是"),a("code",[s._v("/yh/jenkins")])]),s._v(" "),a("li",[s._v("上面的【执行 Shell】参考脚本中，最终打包的压缩包"),a("code",[s._v("yh-ui.tar.gz")]),s._v("就在项目根目录下")]),s._v(" "),a("li",[s._v("所以"),a("strong",[s._v("Source files")]),s._v("就是"),a("code",[s._v("yh-ui.tar.gz")])]),s._v(" "),a("li",[a("strong",[s._v("Remove prefix")]),s._v("，不填")]),s._v(" "),a("li",[a("strong",[s._v("Remote directory")]),s._v("，假设填入是"),a("code",[s._v("/bb")])]),s._v(" "),a("li",[s._v("最终推送到服务器的包路径为："),a("code",[s._v("/yh/jenkins/bb/yh-ui.tar.gz")])]),s._v(" "),a("li",[a("strong",[s._v("Exec command")]),s._v("：远程服务器的shell命令")])])])]),s._v(" "),a("blockquote",[a("ul",[a("li",[a("p",[s._v("一般远程服务器配置好docker、docker-compse脚本，只需更新jar包或静态包")])]),s._v(" "),a("li",[a("p",[s._v("或者jenkins主机安装dockr，直接通过【docker插件】发布至docker仓库，远程服务直接下载镜像发布")])])])]),s._v(" "),a("h3",{attrs:{id:"定时构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#定时构建"}},[s._v("#")]),s._v(" 定时构建")]),s._v(" "),a("p",[s._v("【构建触发器】阶段，勾选。填的格式支持"),a("code",[s._v("cron")])]),s._v(" "),a("h3",{attrs:{id:"gitlab-触发构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-触发构建"}},[s._v("#")]),s._v(" Gitlab 触发构建")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("安装插件：（"),a("a",{attrs:{href:"https://plugins.jenkins.io/gitlab-hook",target:"_blank",rel:"noopener noreferrer"}},[s._v("Gitlab Hook Plugin"),a("OutboundLink")],1),s._v("）、"),a("a",{attrs:{href:"https://plugins.jenkins.io/gitlab-plugin",target:"_blank",rel:"noopener noreferrer"}},[s._v("Gitlab Plugin"),a("OutboundLink")],1),s._v("、"),a("a",{attrs:{href:"https://plugins.jenkins.io/build-token-root",target:"_blank",rel:"noopener noreferrer"}},[s._v("Build Authorization Token Root Plugin"),a("OutboundLink")],1)])]),s._v(" "),a("li",[a("p",[s._v("Jekins：【系统管理】-【系统配置】找到Gitlab模块，添加配置，如下")]),s._v(" "),a("blockquote",[a("p",[s._v("这一步骤似乎不需要！")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/20210401134028.png",alt:""}})]),s._v(" "),a("p",[s._v("其中Credentials的凭证，类型选择"),a("strong",[s._v("GitLab API Token")]),s._v("，这个token由Gitlab网站生成。")]),s._v(" "),a("blockquote",[a("p",[s._v("GitLab：【用户设置】-【访问令牌】-【个人访问令牌】，权限都勾选，确认时效，生成。")])])]),s._v(" "),a("li",[a("p",[s._v("项目构建配置中，在【构建触发器】，选择【Build when a change is pushed to GitLab】")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/20210401134923.png",alt:""}})])]),s._v(" "),a("li",[a("p",[s._v("Gitlab：项目仓库-【设置】-【集成（Integrations）】，配置上面Jenkins得到的URL和密钥")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/20210401135452.png",alt:""}})]),s._v(" "),a("p",[s._v("点击【Add webhook】按钮，添加后【编辑】【Test】可以测试、查看详情")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/20210401135810.png",alt:""}})]),s._v(" "),a("p",[s._v("点击【View details】可以看到请求详情。通过查看请求参数，可以得知原理，即Gitlab根据设定的事件，发送请求给Jenkins，Jenkins那边验证后（分支验证），触发构建。这个请求也可用postman或其他方式模拟调用。")])]),s._v(" "),a("li",[a("p",[s._v("Jenkins中项目的构建日志，第一行可以得知，触发用户，即Gitlab记录最新提交的用户")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Started by GitLab push by xxxxx\nRunning as SYSTEM\nBuilding in workspace /var/jenkins_home/workspace/iot-ui\n......\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])])]),s._v(" "),a("h2",{attrs:{id:"关于迁移"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关于迁移"}},[s._v("#")]),s._v(" 关于迁移")]),s._v(" "),a("p",[s._v("方式一：不推荐")]),s._v(" "),a("p",[s._v("复制所有数据，即目录"),a("code",[s._v("/var/jenkins_home")]),s._v("，全部拷贝至新服务器。")]),s._v(" "),a("blockquote",[a("p",[s._v("实践测试，压缩后也有上百G至少，因为包括构建版本和依赖包仓库")])]),s._v(" "),a("p",[s._v("方式二：可选")]),s._v(" "),a("p",[s._v("仅复制目录："),a("code",[s._v("/users、/plugins、/jobs")]),s._v("。这样新服务器第一次初始化后，停止服务替换这些目录再重启服务。"),a("strong",[s._v("可保障用户权限信息、项目任务、插件不变")])]),s._v(" "),a("p",[s._v("但是！！Jenkins上的"),a("strong",[s._v("凭证信息都没有迁移过来")]),s._v("。可能在其他地方！")]),s._v(" "),a("p",[a("strong",[s._v("自定义安装的插件也需要重新安装")]),s._v("，插件目录是"),a("code",[s._v("/tools")])]),s._v(" "),a("blockquote",[a("p",[s._v("实践是重新配置了凭证，包括SSH和Git账户的凭证，项目需要更新凭证和SSH推送配置。")])]),s._v(" "),a("blockquote",[a("p",[s._v("这种方式有不太完善，后续有机会再测试更新")])])])}),[],!1,null,null,null);t.default=e.exports}}]);