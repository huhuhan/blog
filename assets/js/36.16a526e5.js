(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{536:function(s,a,t){"use strict";t.r(a);var n=t(4),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"jvm-简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jvm-简介"}},[s._v("#")]),s._v(" JVM 简介")]),s._v(" "),t("p",[s._v("JVM 即 JAVA 虚拟机 ，由C语言开发。")]),s._v(" "),t("p",[s._v("JVM也有不同厂商开发，主要有如下几种")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("HotSpot")]),s._v("，即最常见，Sun 公司开发。后续内容就是这个版本JVM")]),s._v(" "),t("li",[s._v("JRockit，是Oracle 公司开发")]),s._v(" "),t("li",[s._v("IBM，即IBM公司开发")])]),s._v(" "),t("p",[s._v("简单例子介绍")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("java demo.class\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",[t("li",[s._v("运行以上命令，操作系统创建一个进程执行JAVA程序")]),s._v(" "),t("li",[s._v("JAVA程序会创建JVM，JVM加载运行")]),s._v(" "),t("li",[s._v("JAVA通过JNI调用C语言代码实现Socket通信，JVM处理字节码命令")]),s._v(" "),t("li",[s._v("进程的虚拟地址空间，分配一部分空间给JVM使用，即"),t("strong",[s._v("JVM内存")])]),s._v(" "),t("li",[s._v("进程的剩余其他空间，即进程内存，对JVM来说，统称为"),t("strong",[s._v("本地内存")])])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/20200511161031511.png",alt:""}})]),s._v(" "),t("blockquote",[t("p",[s._v("参考："),t("a",{attrs:{href:"https://didispace-wx.blog.csdn.net/article/details/102889416",target:"_blank",rel:"noopener noreferrer"}},[s._v("博客"),t("OutboundLink")],1),s._v("、"),t("a",{attrs:{href:"https://www.jianshu.com/p/76959115d486",target:"_blank",rel:"noopener noreferrer"}},[s._v("博客"),t("OutboundLink")],1)])]),s._v(" "),t("h2",{attrs:{id:"内存结构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#内存结构"}},[s._v("#")]),s._v(" 内存结构")]),s._v(" "),t("h3",{attrs:{id:"运行时数据区"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行时数据区"}},[s._v("#")]),s._v(" 运行时数据区")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/0b7ead804a1c0ad99a5c72d53775227f_652x625.png",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/20210608142841.png",alt:""}})]),s._v(" "),t("ul",[t("li",[t("p",[t("strong",[s._v("堆内存")]),s._v("：理解为管理内存的主要区域，多线程共享。")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v(" 存储的数据包括\n\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v(" 实例对象（Student对象）\n\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v(" 数组（数据，非引用）\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v(" 垃圾回收负责的主要区域\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v(" 逃逸分析（待研究）\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.")]),s._v(" 区域分：新生代"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Yong区（"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("个Eden区、"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("个Survivor区）、Old区"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("方法区")]),s._v("：和堆一样，多线程共享的内存区域。")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v(" 存储的数据包括\n\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v(" 虚拟机加载的类（System类）\n\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v(" 静态变量（static修饰的Student类）\n\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v(" 运行时常量池的常量（NUMBER）\n\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.")]),s._v(" 即时编译后的class代码（比如动态代理生成的代理类），即JIT代码缓存\n\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("、全局对象的引用（stu）？\n\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("、类元信息、方法元信息、域（Field）元信息\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v(" 运行时常量池\n\t是运行时将常量池加载到方法区\n\t将符合引用转为直接引用\n\t包括字符串常量池，其他常量\n\t字符串常量池比较特殊，占内存相对较大\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v(" 永久代，运行时数据区的"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("个区域是JVM的设计规范，Pern区（永久代）是HotSpot虚拟机对方法区的实现方案即，JDK7后又取消永久代的设计。\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.")]),s._v(" 元空间，JDK8新设计，方法区新的实现方案，不过存储位置在本地内存中，不在JVM内存中。\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.")]),s._v(" 数据存储变化\n\t静态变量、运行时常量池，在堆内存\n\t类、方法、域等元信息，在元空间\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])])])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xNTE3ODcxOS0wNjc3NzMwMjkxMmNmZGQ2P2ltYWdlTW9ncjIvYXV0by1vcmllbnQvc3RyaXAlN0NpbWFnZVZpZXcyLzIvdy8xMDAwL2Zvcm1hdC93ZWJw.webp",alt:""}})]),s._v(" "),t("ul",[t("li",[t("p",[t("strong",[s._v("程序计数器")]),s._v("：理解为存储当前线程的指令步骤。线程私有")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[s._v("因为一个CPU在某一时刻只能处理一个线程的一个指令，多线程情况下，CUP需要切换线程处理。保证切换后回到各自线程继续处理指令。运行java方法，存储字节码指令地址；运行native方法，不存储；\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("虚拟机栈")]),s._v("：理解为Java方法运行的内存模型。线程私有")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v(" 一个方法执行对应创建一个栈帧，比如main方法栈帧\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v(" 在当前线程虚拟机栈中，栈帧执行顺序：先进后出\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v(" 一个栈帧中存储了：\n\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v(" 局部变量表，存放方法局部变量、基本类型（比如"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v("、"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("）\n\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v(" 操作数栈（记录操作步骤，比如上图左边的指令表）\n\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v(" 动态链接（指向常量池的引用）\n\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.")]),s._v(" 方法返回地址（当前栈帧的出栈，将返回值给上层方法栈帧，继续处理）\n\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.")]),s._v(" 其他信息\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.")]),s._v(" 栈帧大小，在编译阶段已确认，加载到JVM中\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/A0bYOQcma0PGgLpviaZ3JSMwUWoVZoYKByibrKHLeoBcpibh3iaXNax7IALGCjK75kD6WkvRIA1lHfLD5XrCz0oCjw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1",alt:""}})])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("本地方法栈")]),s._v("：原理同虚拟机栈。是适用于本地方法（Native 关键字修饰的方法）。线程私有")])])]),s._v(" "),t("h2",{attrs:{id:"垃圾回收机制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#垃圾回收机制"}},[s._v("#")]),s._v(" 垃圾回收机制")]),s._v(" "),t("p",[s._v("JAVA GC 即Garbage Collection， 垃圾回收机制，是JVM内存回收机制，简称GC。")]),s._v(" "),t("p",[s._v("运行时数据区的5大区域中，主要针对共享区的"),t("strong",[s._v("堆内存、方法区")]),s._v("，线程私有的内存随着线程销毁回收。")]),s._v(" "),t("h3",{attrs:{id:"判断存活算法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#判断存活算法"}},[s._v("#")]),s._v(" 判断存活算法")]),s._v(" "),t("p",[s._v("GC回收"),t("strong",[s._v("堆内存、方法区")]),s._v("中的对象，通过判断对象是否存活（死去即不再被引用）")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[s._v("引用计数算法\n早期算法，这种算法判断很简单，就是给对象添加一个引用计数器，每当对象被引用一次就加"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("，引用失效时就减"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("。当为"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("的时候就判断对象不会再被引用。\n优点"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("实现简单效率高，被广泛使用与如python何游戏脚本语言上。\n缺点"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("难以解决循环引用的问题，就是假如两个对象互相引用已经不会再被其它其它引用，导致一直不会为"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("就无法进行回收。\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[t("strong",[s._v("可达性分析算法")]),s._v("：通过一个称为“GC Roots”的对象为"),t("strong",[s._v("起始点")]),s._v("，搜索所经过的路径称为"),t("strong",[s._v("引用链")]),s._v("，当一个对象到GC Roots"),t("strong",[s._v("没有任何引用跟它连接")]),s._v("，则证明"),t("strong",[s._v("对象是不可用")]),s._v("的。有效解决了引用计数算法的循环利用弊端。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/10006199-854e1de91f66764b.webp",alt:""}})]),s._v(" "),t("p",[s._v("可作为GC Roots的对象有四种")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v(" 虚拟机栈"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("栈桢中的本地变量表"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("中的引用的对象。\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v(" 方法区中的类静态属性引用的对象，一般指被static修饰引用的对象，加载类的时候就加载到内存中。\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v(" 方法区中的常量引用的对象"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.")]),s._v(" 本地方法栈中JNI（native方法"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("引用的对象\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"垃圾回收算法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#垃圾回收算法"}},[s._v("#")]),s._v(" 垃圾回收算法")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[s._v("为了高效的回收，jvm将堆分为三个区域\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v(" 新生代（Young Generation），分"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("个Eden区、两个Survivor区\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v(" 老年代（Old Generation）\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v(" 永久代（Permanent Generation）【"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.8")]),s._v("以后采用元空间Metaspace，就不在堆中了】\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("​\t"),t("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/20f61812fe7ebd758273caad400e7586_1010x418.png",alt:""}})]),s._v(" "),t("p",[s._v("JVM采用"),t("code",[s._v("分代收集算法")]),s._v("对不同区域、不同大小对象、不同对象存活时长，采用不同的回收算法。")]),s._v(" "),t("p",[s._v("新生代，采用"),t("strong",[s._v("复制算法")]),s._v("。大部分对象存活率低，少量对象的区域复制就完成清除。")]),s._v(" "),t("ul",[t("li",[s._v("对象分配方式如下：（两个Survivor区，以下简称From 区和To 区）\n"),t("ul",[t("li",[s._v("优先在Eden区分配，其次From 区，此时To 区为空")]),s._v(" "),t("li",[s._v("当Eden区空间不足，发起一次"),t("code",[s._v("Minor GC")]),s._v("("),t("code",[s._v("Young GC")]),s._v("，即"),t("code",[s._v("YGG")]),s._v(")")]),s._v(" "),t("li",[t("strong",[s._v("没有引用的回收掉，剩下存活的复制到To 区")]),s._v("（To 区大小放不下就直接到老年代）")]),s._v(" "),t("li",[s._v("From区也同样处理，分到To 区或老年代")]),s._v(" "),t("li",[s._v("此时Eden区、From区为空，To 区有数据")]),s._v(" "),t("li",[s._v("再分配：优先Eden区，其次To区，From区作备用。"),t("strong",[s._v("From区和To 区的交换使用")])])])])]),s._v(" "),t("blockquote",[t("p",[s._v("复制，其实就是移动。不是说复制后有2个相同的。")])]),s._v(" "),t("p",[s._v("老年代，采用"),t("strong",[s._v("标记/整理")]),s._v("或"),t("strong",[s._v("标记/清除")]),s._v("算法")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("上面"),t("code",[s._v("Young GC")]),s._v("，有些对象在From区和To 区来回移动，每个对象有计数器，到了指定值就到老年代")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("-XX:MAXTenuringThrehold")]),s._v("参数就是计数值，默认15")])]),s._v(" "),t("li",[t("p",[s._v("这里存储的是新生代复制而来的对象、直接进入的大对象")]),s._v(" "),t("ul",[t("li",[s._v("老年代空间不足，发起一次"),t("code",[s._v("Full GC")]),s._v("，即"),t("code",[s._v("FGG")]),s._v("。")])])]),s._v(" "),t("li",[t("p",[s._v("然后再次尝试存放老年代，还不行就是内存溢出"),t("code",[s._v("OOM")]),s._v("（优化之一就是尽量避免触发Full GC）")])])]),s._v(" "),t("h3",{attrs:{id:"垃圾回收器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#垃圾回收器"}},[s._v("#")]),s._v(" 垃圾回收器")]),s._v(" "),t("p",[s._v("即垃圾回收的具体实现，针对不同场景和配置，GC采用不同的回收器，可配合使用，如图")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/b13f9fea4441821a7511457e3e6d10a8_892x563.png",alt:""}})]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[s._v("新生代\nSerial：单线程操作，回收时停止其他线程，结束后其他线程再工作。简单高效。采用复制算法。\nParNew：多线程操作，Serial升级版，可以配合CMS回收器一起用。\nParallel Scavenge：多线程操作，侧重吞吐量\n【吞吐量 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 代码运行时间 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("代码运行时间 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" 垃圾收集时间"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 如果代码运行"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("min垃圾收集"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("min，则为"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("99")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("】\n\n老年代，\nSerial Old：单线程操作，类似Serial，但算法不同（标记"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("整理算法）\nParallel Old：多线程操作\nCMS：支持并发，采用标记"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("清除算法，生命周期（初始标记"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("并发标记"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("重新标记"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("并发清除）\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[s._v("最新G1回收器\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v(" JDK1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("出现，理解为CMS的升级版，解决CMD产生的空间碎片（压缩空间的功能）。\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v(" 算法是标记"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("整理 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" 复制。\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v(" 混合使用，不属于某分区。\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.")]),s._v(" 默认关闭（和JDK版本有关），开启配置【"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("XX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("UseG1GC】，\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.")]),s._v(" 将堆内存区域化，标记为若干个【region】，配置参数【"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("XX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("G1HeapRegionSize"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("n】默认自动分配（"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("的幂）\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.")]),s._v(" 采用并发标记、并发复制操作，降低停顿时间。最大停顿时间【"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("XX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("MaxGCPauseMillis"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("】默认"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[s._v("回收模式\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v(" Minor GC"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 在新生代"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("包括Eden区和Survivor区"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("中的垃圾回收。默认经过"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("次后还存活就复制到老年代。\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v(" Major GC"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 在老年代的垃圾回收，有时需要将新生代清理将部分对象复制而来，类似Full GC\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v(" Full GC"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v(" 所有区域的回收，包括新生代、老年代、元空间等等。\n\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v(" 【System"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("gc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("】禁止直接使用。\n\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v(" 老年代空间不足会触发。优化目标就是避免触发。\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.")]),s._v(" Mixed GC"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 仅G1回收器才有。回收新生代和部分老年代\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/73230d3cdceb46300d51f8aaf5f262d3eca.jpg",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"疑问点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#疑问点"}},[s._v("#")]),s._v(" 疑问点")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("标记算法中，如何判断对象是否被标记？")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[s._v("通过JVM提供的OOPMap数据结构，存储引用链上引用过的位置，避免全局扫描\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("什么是空间分配担保？")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[s._v("在minor gc前，jvm会先检查老年代最大可用空间是否大于新生代所有对象总空间，如果是的话，则minor gc可以确保是安全的\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("为什么新生代的复制算法分2个Survivor区？")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[s._v("保证复制算法运行的效率，直接复制去老年代可能导致内存不足，直接触发Full GC。且老年代的对象是经过多次可达性分析算法存活的对象。（默认"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("次）\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("为什么是Stop the World？")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[s._v("进行GC操作时，停止除GC外的所有线程。（侧重高吞吐的回收器，需要减短停顿时间）\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])]),s._v(" "),t("h2",{attrs:{id:"调优分析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#调优分析"}},[s._v("#")]),s._v(" 调优分析")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/8128f56458ac53d496d0d7a18f75ba61_2256x1058.png",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"配置参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置参数"}},[s._v("#")]),s._v(" 配置参数")]),s._v(" "),t("blockquote",[t("ul",[t("li",[t("code",[s._v("-")]),s._v("： 标准VM选项，VM规范的选项。")]),s._v(" "),t("li",[t("code",[s._v("-X")]),s._v("： 运行参数，非标准VM选项，不保证所有VM支持。")]),s._v(" "),t("li",[t("code",[s._v("-XX")]),s._v("： 高级选项，高级特性，但属于不稳定的选项。")])]),s._v(" "),t("p",[s._v("老年代需要计算，空间大小 = 堆空间大小 - 新生代大空间大小")])]),s._v(" "),t("p",[s._v("常见参数：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("-Xms")]),s._v("设置堆的最小空间大小。"),t("code",[s._v("ms")]),s._v(" 是memory start的简称")]),s._v(" "),t("li",[t("code",[s._v("-Xmx")]),s._v("设置堆的最大空间大小。"),t("code",[s._v("mx")]),s._v("是memory max的简称")]),s._v(" "),t("li",[t("code",[s._v("-Xmn")]),s._v("堆中新生代初始及最大大小（NewSize和MaxNewSize为其细化）。")]),s._v(" "),t("li",[t("code",[s._v("-XX:NewSize")]),s._v("设置新生代最小空间大小。")]),s._v(" "),t("li",[t("code",[s._v("-XX:MaxNewSize")]),s._v("设置新生代最大空间大小。")]),s._v(" "),t("li",[t("code",[s._v("-XX:PermSize")]),s._v("设置永久代最小空间大小。（jdk1.8后"),t("code",[s._v("permSize")]),s._v("替换为"),t("code",[s._v("metaspaceSize")]),s._v("）")]),s._v(" "),t("li",[t("code",[s._v("-XX:MaxPermSize")]),s._v("设置永久代最大空间大小。（jdk1.8后"),t("code",[s._v("permSize")]),s._v("替换为"),t("code",[s._v("MaxMetaspaceSize")]),s._v("）")]),s._v(" "),t("li",[t("code",[s._v("-Xss")]),s._v("设置每个线程的堆栈大小。")])]),s._v(" "),t("p",[s._v("其他参数")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[s._v("【"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("XX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("PrintGCDetails】 打印GC日志\n【"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("XX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("PrintGCDateStamps】 GC日志加上时间戳\n【"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("XX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("PrintGCTimeStamps】 GC每次输出日志的计时（从"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("开始）\n【"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Xloggc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("yh_gc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log】 GC日志文件路径（当前路径）\n【"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("XX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("UseParNewGC】使用ParNew垃圾回收器，其他参考垃圾回收器的种类\n【"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("XX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("UseG1GC】 使用G1垃圾回收器，适合堆内存"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("G起\n【"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("XX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("MaxGCPauseMillis】 G1垃圾回收器的停顿时长，毫秒\n【"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("XX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("ParallelRefProcEnabled】 开启并行处理引用对象\n【"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("XX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("HeapDumpOnOutOfMemoryError】 发成OOM时生成DUMP文件\n【"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("XX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("HeapDumpPath】 DUMP文件路径\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("4核8G服务器JDK8的JVM配置参考")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Xmx5440M "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Xms5440M \\\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("XX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("MaxMetaspaceSize"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")]),s._v("M "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("XX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("MetaspaceSize"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")]),s._v("M \\\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("XX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("UseG1GC "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("XX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("MaxGCPauseMillis"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("XX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("ParallelRefProcEnabled \\\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("XX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("HeapDumpOnOutOfMemoryError "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("XX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("HeapDumpPath"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("_dump"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hprof \\\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("XX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("PrintGCDetails "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("XX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("PrintGCDateStamps "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Xloggc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("_gc_trace"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[s._v("一般都会将JVM的"),t("code",[s._v("Xms")]),s._v("和"),t("code",[s._v("Xmx")]),s._v("的值设置成一样，避免GC或请求高峰导致的内存调整变化造成的压力")])]),s._v(" "),t("h3",{attrs:{id:"内存溢出"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#内存溢出"}},[s._v("#")]),s._v(" 内存溢出")]),s._v(" "),t("p",[s._v("OOM，即"),t("code",[s._v("OutOfMemeyError")]),s._v("，常见以下几种情况：")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" in thread “main”"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lang"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),s._v("OutOfMemoryError")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Java")]),s._v(" heap space\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" in thread “main”"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lang"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),s._v("OutOfMemoryError")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PermGen")]),s._v(" space\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("虚拟机栈、本地方法栈：\n"),t("ul",[t("li",[s._v("存在多线程时，栈帧空间不够分配，抛出OOM")]),s._v(" "),t("li",[s._v("仅单线程时，栈帧空间不够分配，抛出"),t("code",[s._v("StackOverflowError")])])])])]),s._v(" "),t("p",[s._v("常见的"),t("code",[s._v("OutOfMemeyError")]),s._v("类型如下：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("对象不能被分配到堆内存中")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" in thread “main”"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lang"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),s._v("OutOfMemoryError")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Java")]),s._v(" heap space\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("类或者方法不能被加载到老年代。它可能出现在一个程序加载很多类的时候，比如引用了很多第三方的库。")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" in thread “main”"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lang"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),s._v("OutOfMemoryError")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PermGen")]),s._v(" space\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("创建的数组大于堆内存的空间")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" in thread “main”"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lang"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),s._v("OutOfMemoryError")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Requested")]),s._v(" array size exceeds VM limit\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("分配本地分配失败。JNI、本地库或者Java虚拟机都会从本地堆中分配内存空间。")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" in thread “main”"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lang"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),s._v("OutOfMemoryError")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" request "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("size"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" bytes "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("reason"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Out")]),s._v(" of swap space"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("同样是本地方法内存分配失败，只不过是JNI或者本地方法或者Java虚拟机发现。")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" in thread “main”"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lang"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),s._v("OutOfMemoryError")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("reason"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("stack trace"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("（"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Native")]),s._v(" method）\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])]),s._v(" "),t("h3",{attrs:{id:"工具应用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#工具应用"}},[s._v("#")]),s._v(" 工具应用")]),s._v(" "),t("p",[s._v("JDK自带的"),t("code",[s._v("jconsole.exe")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/20210609113055.png",alt:""}})]),s._v(" "),t("p",[s._v("JDK自带的"),t("code",[s._v("jstat.exe")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("D:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Program Files"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("jdk"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("8u251"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("bin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("jstat -gcutil "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17232")]),s._v("\n  S0     S1     E      O      M     CCS    YGC     YGCT    FGC    FGCT     GCT\n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24.38")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64.51")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("68.26")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("96.88")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("94.09")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.046")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.046")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.092")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[s._v("S0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 新生代"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("survivor space0简称 就是准备复制的那块 单位为"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("\nS1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 指新生代s1已使用百分比，为"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("的话说明没有存活对象到这边\nE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 新生代eden区域"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 老年代"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nM"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 元空间"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nCCS"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \nYGC"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Yang gc 次数\nYGCT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Yang gc 耗时"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("秒"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nFGC"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Full gc 次数\nFGCT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Full gc 耗时"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("秒"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nGCT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" YGCT"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("FGCT 耗时"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("秒"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);