(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{562:function(s,t,a){"use strict";a.r(t);var e=a(4),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"指标监控-prometheus-grafana-exporter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#指标监控-prometheus-grafana-exporter"}},[s._v("#")]),s._v(" 指标监控  Prometheus + Grafana + Exporter")]),s._v(" "),a("h2",{attrs:{id:"简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),a("h3",{attrs:{id:"prometheus"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prometheus"}},[s._v("#")]),s._v(" Prometheus")]),s._v(" "),a("ul",[a("li",[s._v("开源的系统监控报警平台")]),s._v(" "),a("li",[s._v("以HTTP协议采集时许数据，并存储在本地数据库")]),s._v(" "),a("li",[s._v("支持服务发现机制，自动完成数据采集")]),s._v(" "),a("li",[s._v("平台本身提供PromQL 查询方式和HTTP接口，以及GUI组件展示数据")])]),s._v(" "),a("h3",{attrs:{id:"grafana"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#grafana"}},[s._v("#")]),s._v(" Grafana")]),s._v(" "),a("ul",[a("li",[s._v("开源的可视化监控指标展示平台")]),s._v(" "),a("li",[s._v("支持各种指标图表、仪表盘，并有公共开源仓库")]),s._v(" "),a("li",[s._v("支持多租户、角色等多维度权限控制")]),s._v(" "),a("li",[s._v("支持多种数据库源集成，与"),a("strong",[s._v("Prometheus")]),s._v("集成度高")]),s._v(" "),a("li",[s._v("支持警报通知，插件方式很多")])]),s._v(" "),a("h3",{attrs:{id:"exporter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#exporter"}},[s._v("#")]),s._v(" Exporter")]),s._v(" "),a("ul",[a("li",[s._v("采集数据的服务节点")]),s._v(" "),a("li",[s._v("基于Prometheus的服务发现机制，自动采集数据")])]),s._v(" "),a("blockquote",[a("ul",[a("li",[s._v("官网："),a("a",{attrs:{href:"https://grafana.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Grafana"),a("OutboundLink")],1),s._v("、"),a("a",{attrs:{href:"https://prometheus.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Prometheus"),a("OutboundLink")],1)]),s._v(" "),a("li",[s._v("参考："),a("a",{attrs:{href:"https://www.cnblogs.com/myzony/p/10253986.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("博客"),a("OutboundLink")],1),s._v("、"),a("a",{attrs:{href:"https://www.cnblogs.com/liping0826/p/14841274.html#4promethus%E7%9B%91%E6%8E%A7mysql%E6%95%B0%E6%8D%AE%E5%BA%93",target:"_blank",rel:"noopener noreferrer"}},[s._v("博客"),a("OutboundLink")],1)])])]),s._v(" "),a("h2",{attrs:{id:"软件安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#软件安装"}},[s._v("#")]),s._v(" 软件安装")]),s._v(" "),a("blockquote",[a("p",[s._v("以下均为docker版安装方式，若各服务的docker-compose放在一起，同个网络IP、端口可以直接用容器服务名和默认端口")])]),s._v(" "),a("h3",{attrs:{id:"prometheus-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prometheus-2"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"http://120.24.61.35:8921/classic/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Prometheus"),a("OutboundLink")],1)]),s._v(" "),a("h4",{attrs:{id:"docker-compose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose"}},[s._v("#")]),s._v(" docker-compose")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prometheus")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" prom/prometheus                               \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" prometheus                             \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" unless"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("stopped\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                                                     \n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /yh/soft/prometheus/data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/prometheus\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /yh/soft/prometheus/conf/prometheus.yml"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/etc/prometheus/prometheus.yml\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                             \n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 服务端口"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9090")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("ul",[a("li",[a("p",[s._v("根据实际修改以上信息：挂载目录、服务端口")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("prometheus.yml")]),s._v("默认配置")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# my global config")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("global")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scrape_interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 15s "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Set the scrape interval to every 15 seconds. Default is every 1 minute.")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("evaluation_interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 15s "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Evaluate rules every 15 seconds. The default is every 1 minute.")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# scrape_timeout is set to the global default (10s).")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Alertmanager configuration")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("alerting")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("alertmanagers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("static_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - alertmanager:9093")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Load rules once and periodically evaluate them according to the global 'evaluation_interval'.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rule_files")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# - "first_rules.yml"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# - "second_rules.yml"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# A scrape configuration containing exactly one endpoint to scrape:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Here it's Prometheus itself.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scrape_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The job name is added as a label `job=<job_name>` to any timeseries scraped from this config.")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"prometheus"')]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# metrics_path defaults to '/metrics'")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# scheme defaults to 'http'.")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("static_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9090"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br")])])])]),s._v(" "),a("h4",{attrs:{id:"访问测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#访问测试"}},[s._v("#")]),s._v(" 访问测试")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/image-20211028151508965.png",alt:""}})]),s._v(" "),a("blockquote",[a("p",[s._v("镜像更新升级，配置可能会变")]),s._v(" "),a("ul",[a("li",[s._v("可以先部署容器，拷贝默认配置出来再部署")]),s._v(" "),a("li",[s._v("访问网页，选择"),a("code",[s._v("Status-Configuration")]),s._v("页面，可以看到有效的配置属性")])]),s._v(" "),a("p",[a("code",[s._v("Status-Targets")]),s._v("页面，是监控组件的信息，类似Euraka注册中心，可以看到配置中注册的监控节点，节点服务从"),a("a",{attrs:{href:"https://prometheus.io/docs/instrumenting/exporters/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Prometheus库"),a("OutboundLink")],1),s._v("中选择，或者自制。")])]),s._v(" "),a("h3",{attrs:{id:"grafana-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#grafana-2"}},[s._v("#")]),s._v(" Grafana")]),s._v(" "),a("h4",{attrs:{id:"docker-compose-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-2"}},[s._v("#")]),s._v(" docker-compose")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("grafana")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" grafana/grafana                               \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" grafana                             \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" unless"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("stopped\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                                                     \n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /yh/soft/grafana/data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/var/lib/grafana\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置文件属性挺多的，考虑后面直接进容器修改。需要挂载的话参考Prometheus的方式")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- /ws/soft/grafana/config/grafana.ini:/etc/grafana/grafana.ini")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /yh/soft/grafana/log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/var/log/grafana\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                             \n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 服务端口"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("ul",[a("li",[a("p",[s._v("根据实际修改以上信息：挂载目录、服务端口")])]),s._v(" "),a("li",[a("p",[s._v("访问服务，默认账户"),a("code",[s._v("admin/admin")]),s._v("，第一次登录会要求修改密码")])])]),s._v(" "),a("h4",{attrs:{id:"配置数据源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置数据源"}},[s._v("#")]),s._v(" 配置数据源")]),s._v(" "),a("p",[s._v("如图，选择"),a("strong",[s._v("Prometheus")]),s._v("，仅填写服务地址即可，测试保存。其他数据库源同理。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/image-20211028111104395.png",alt:"image-20211028111104395"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/image-20211028111145533.png",alt:"image-20211028111145533"}})]),s._v(" "),a("h4",{attrs:{id:"配置告警功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置告警功能"}},[s._v("#")]),s._v(" 配置告警功能")]),s._v(" "),a("blockquote",[a("p",[s._v("这里是用系统邮箱发送目标邮箱的通知方式，其他方式后续补充")])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("配置文件"),a("code",[s._v("/etc/grafana/grafana.ini")]),s._v("，找到"),a("code",[s._v("[stmp]")]),s._v("相关属性修改，如下")]),s._v(" "),a("div",{staticClass:"language-ini line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token selector"}},[s._v("[smtp]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("enabled")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("host")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 发信服务器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("user")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 邮箱地址")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# If the password contains # or ; you have to wrap it with triple quotes. Ex """#password;"""')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("password")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 邮箱密码或服务密码")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";cert_file =")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";key_file =")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";skip_verify = false")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("from_address")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 邮箱地址")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("from_name")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 邮箱别名")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# EHLO identity in SMTP dialog (defaults to instance_name)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";ehlo_identity = dashboard.example.com")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# SMTP startTLS policy (defaults to 'OpportunisticStartTLS')")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";startTLS_policy = NoStartTLS")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("默认属性都是注释的，根据实际修改为自己的信息，再重启服务")]),s._v(" "),a("ul",[a("li",[s._v("发信服务器，比如"),a("code",[s._v("smtp.qiye.aliyun.com:465")])]),s._v(" "),a("li",[s._v("邮箱地址、邮箱密码或服务密码、邮箱别名")]),s._v(" "),a("li",[s._v("邮箱需要开通SMTP、POP3之类的功能，邮箱官网登录后设置中有")])])]),s._v(" "),a("li",[a("p",[s._v("网站中添加通知配置")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/image-20211028171109012.png",alt:"image-20211028171109012"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/image-20211028171448369.png",alt:"image-20211028171448369"}})])])]),s._v(" "),a("h2",{attrs:{id:"exporter参考例子"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#exporter参考例子"}},[s._v("#")]),s._v(" Exporter参考例子")]),s._v(" "),a("blockquote",[a("p",[s._v("大致步骤")]),s._v(" "),a("p",[s._v("1、先在"),a("a",{attrs:{href:"https://grafana.com/grafana/dashboards/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Grafana库"),a("OutboundLink")],1),s._v("或"),a("a",{attrs:{href:"https://prometheus.io/docs/instrumenting/exporters/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Prometheus库"),a("OutboundLink")],1),s._v("搜索组件")]),s._v(" "),a("p",[s._v("2、监控组件和exporter插件一般都是一一对应的")]),s._v(" "),a("p",[s._v("3、部署exporter服务")]),s._v(" "),a("p",[s._v("4、Prometheus配置exporter")]),s._v(" "),a("p",[s._v("5、Grafana添加图表组件")]),s._v(" "),a("p",[s._v("6、验证效果")]),s._v(" "),a("p",[s._v("以Prometheus-MySQL为例子")])]),s._v(" "),a("h3",{attrs:{id:"prometheus-mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prometheus-mysql"}},[s._v("#")]),s._v(" Prometheus-MySQL")]),s._v(" "),a("h4",{attrs:{id:"安装监控插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装监控插件"}},[s._v("#")]),s._v(" 安装监控插件")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("docker-compose")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mysql-exporter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("exporter\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" prom/mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("exporter\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" DATA_SOURCE_NAME=账户"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("密码@(IP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("端口)/\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                             \n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 服务端口"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9104")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("根据实际修改以上信息：账户、密码、IP、端口、服务端口")])]),s._v(" "),a("li",[a("p",[s._v("访问监控服务，测试如图")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/image-20211028151609331.png",alt:"image-20211028151609331"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/image-20211028151557637.png",alt:"image-20211028151557637"}})])])]),s._v(" "),a("h4",{attrs:{id:"注册到prometheus"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注册到prometheus"}},[s._v("#")]),s._v(" 注册到Prometheus")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("修改"),a("code",[s._v("prometheus.yaml")]),s._v("，"),a("code",[s._v("scrape_configs")]),s._v("属性下添加配置，重启"),a("strong",[s._v("Prometheus")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ....上面配置省略")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scrape_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 其他配置省略\t")]),s._v("\n  \n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# MySQL 监控配置")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mysql'")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 抓取间隔")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scrape_interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 5s\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("static_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'IP:端口'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("根据实际修改以上信息："),a("code",[s._v("mysql-exporter")]),s._v("服务的IP、端口")])]),s._v(" "),a("li",[a("p",[s._v("访问"),a("strong",[s._v("Prometheus")]),s._v("的"),a("code",[s._v("Status-Targets")]),s._v("页面，测试如图")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/image-20211028151805857.png",alt:"image-20211028151805857"}})])])]),s._v(" "),a("h4",{attrs:{id:"添加到grafana"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加到grafana"}},[s._v("#")]),s._v(" 添加到"),a("strong",[s._v("Grafana")])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("从官方插件库找个Prometheus的PostgresSQL图表。这里选择"),a("a",{attrs:{href:"https://grafana.com/grafana/dashboards/7362",target:"_blank",rel:"noopener noreferrer"}},[s._v("Grafana库的插件7362"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/image-20211028151956335.png",alt:"image-20211028151956335"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/image-20211028152022503.png",alt:"image-20211028152022503"}})]),s._v(" "),a("ul",[a("li",[s._v("复制ID，或下载JSON")]),s._v(" "),a("li",[s._v("根据插件要求按照监控服务，就是上面docker-compose安装的"),a("strong",[s._v("mysqld-exporter")])])])]),s._v(" "),a("li",[a("p",[s._v("导入图表")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/image-20211028112109777.png",alt:"image-20211028112109777"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/image-20211028112359859.png",alt:"image-20211028112359859"}})])]),s._v(" "),a("li",[a("p",[s._v("效果图")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/image-20211028112541783.png",alt:"image-20211028112541783"}})]),s._v(" "),a("ul",[a("li",[a("p",[s._v("数据一开始是没有的，是根据监控间隔抓取的")])]),s._v(" "),a("li",[a("p",[s._v("可以修改图表说明，因为官方下载都是英文")])]),s._v(" "),a("li",[a("p",[s._v("点击Inspect可以测试是否连接成功，测试数据接口调用")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/image-20211028152120999.png",alt:"image-20211028152120999"}})])])])])]),s._v(" "),a("h3",{attrs:{id:"自定义监控图表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自定义监控图表"}},[s._v("#")]),s._v(" 自定义监控图表")]),s._v(" "),a("blockquote",[a("p",[s._v("适合业务服务，比如有个请求日志表，制作成图表监控")])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("新增空图表")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/image-20211028113509479.png",alt:"image-20211028113509479"}})])]),s._v(" "),a("li",[a("p",[s._v("配置数据")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/image-20211028113636132.png",alt:"image-20211028113636132"}})]),s._v(" "),a("ul",[a("li",[a("p",[s._v("右上角选择，图表类型")])]),s._v(" "),a("li",[a("p",[s._v("配置图表数据，默认Builder构建器，可以切换SQL编辑器")])]),s._v(" "),a("li",[a("p",[s._v("部分图表类型支持"),a("strong",[s._v("Alert告警通知")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/huhuhan/img@master/md/pic/image-20211028113826404.png",alt:"image-20211028113826404"}})])])])])]),s._v(" "),a("h3",{attrs:{id:"prometheus-postgresql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prometheus-postgresql"}},[s._v("#")]),s._v(" Prometheus-Postgresql")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("docker-compose")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("postgresql-exporter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" postgresql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("exporter\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" prometheuscommunity/postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("exporter\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" DATA_SOURCE_NAME=postgresql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//账户"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("密码@IP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("端口/postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v("sslmode=disable/\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                             \n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 服务端口"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9187")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("根据实际修改以上信息：数据库的账户、密码、IP、端口，服务端口")]),s._v(" "),a("blockquote",[a("p",[s._v("这个插件仅支持pgsql9.4及以上版本，低版本会缺些系统表")])])]),s._v(" "),a("li",[a("p",[s._v("访问服务，测试是否有效")])]),s._v(" "),a("li",[a("p",[s._v("修改"),a("code",[s._v("prometheus.yaml")]),s._v("，添加"),a("code",[s._v("scrape_configs")]),s._v("配置，重启"),a("strong",[s._v("Prometheus")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ....上面配置省略")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scrape_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 其他配置省略")]),s._v("\n\t\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# PostgresSQL 监控配置")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'postgresql'")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scrape_interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 5s\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("static_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'IP:端口'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("根据实际修改以上信息："),a("code",[s._v("postgresql-exporter")]),s._v("服务的IP、端口")])]),s._v(" "),a("li",[a("p",[s._v("访问"),a("strong",[s._v("Prometheus")]),s._v("的"),a("code",[s._v("Status-Targets")]),s._v("页面，注册是否有效")])]),s._v(" "),a("li",[a("p",[s._v("选择"),a("a",{attrs:{href:"https://grafana.com/grafana/dashboards/9628",target:"_blank",rel:"noopener noreferrer"}},[s._v("Grafana库的插件9628"),a("OutboundLink")],1),s._v("导入")])])]),s._v(" "),a("h3",{attrs:{id:"prometheus-node"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prometheus-node"}},[s._v("#")]),s._v(" Prometheus-Node")]),s._v(" "),a("p",[s._v("即Linux系统的监控数据")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("docker-compose，参考"),a("a",{attrs:{href:"https://github.com/prometheus/node_exporter",target:"_blank",rel:"noopener noreferrer"}},[s._v("Github"),a("OutboundLink")],1),s._v("，采用主机网络，默认端口"),a("code",[s._v("9100")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("node_exporter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" quay.io/prometheus/node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("exporter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" node_exporter\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--path.rootfs=/host'")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("network_mode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" host\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pid")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" host\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" unless"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("stopped\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/:/host:ro,rslave'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("prometheus.yaml")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Linux  监控配置")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'node'")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("static_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'IP:9100'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("重启，访问"),a("strong",[s._v("Prometheus")]),s._v("的"),a("code",[s._v("Status-Targets")]),s._v("页面，注册是否有效")])]),s._v(" "),a("li",[a("p",[s._v("grafana图表插件，比如ID："),a("code",[s._v("1860")])])])]),s._v(" "),a("h3",{attrs:{id:"prometheus-elasticsearch"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prometheus-elasticsearch"}},[s._v("#")]),s._v(" Prometheus-Elasticsearch")]),s._v(" "),a("ul",[a("li",[s._v("docker-compose。参考"),a("a",{attrs:{href:"https://github.com/prometheus-community/elasticsearch_exporter",target:"_blank",rel:"noopener noreferrer"}},[s._v("Github"),a("OutboundLink")],1)])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("elasticsearch_exporter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" quay.io/prometheuscommunity/elasticsearch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("exporter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" elasticsearch_exporter\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 填写ES服务信息")]),s._v("\n     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--es.uri=http://IP:端口'")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" unless"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("stopped\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"服务端口:9114"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("ul",[a("li",[s._v("prometheus.yaml")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Linux  监控配置")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'elasticsearch'")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("static_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'服务IP:服务端口'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[s._v("grafana图表插件，比如ID："),a("code",[s._v("6483")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);